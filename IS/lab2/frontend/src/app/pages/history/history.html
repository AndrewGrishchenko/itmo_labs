<div class="table-wrapper">
  <div *ngIf="isLoading" class="spinner-overlay"><mat-spinner></mat-spinner></div>
  <div class="table-container mat-elevation-z8">
    <div [formGroup]="filterForm">
      <table mat-table [dataSource]="dataSource" matSort matSortActive="creationDate" matSortDirection="desc">
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef>
            <div mat-sort-header="id">ID</div>
            <mat-form-field class="filter-field">
              <input matInput formControlName="id" (click)="$event.stopPropagation()">
            </mat-form-field>
          </th>
          <td mat-cell *matCellDef="let row"> {{row.id}} </td>
        </ng-container>

        <ng-container matColumnDef="creationDate">
          <th mat-header-cell *matHeaderCellDef>
            <div mat-sort-header="creationDate">creationDate</div>
            <mat-form-field class="filter-field">
              <input matInput formControlName="creationDate" (click)="$event.stopPropagation()">
            </mat-form-field>
          </th>
          <td mat-cell *matCellDef="let row"> {{row.creationDate}} </td>
        </ng-container>
        
        <ng-container matColumnDef="user">
          <th mat-header-cell *matHeaderCellDef>
            <div mat-sort-header="user.username">Пользователь</div>
            
            <div class="picker-filter-container">
              <button mat-stroked-button class="picker-button" (click)="openOwnerFilterSelector()">
                {{ filterForm.get('user')?.value?.username || 'Выбрать...' }}
              </button>
              <button *ngIf="filterForm.get('user')?.value"
                      mat-icon-button class="clear-button" (click)="clearOwnerFilter($event)">
                <mat-icon>close</mat-icon>
              </button>
            </div>
          </th>
          <td mat-cell *matCellDef="let row"> {{row.user.username}} </td>
        </ng-container>

        <ng-container matColumnDef="operationStatus">
          <th mat-header-cell *matHeaderCellDef>
            <div mat-sort-header="operationStatus">operationStatus</div>
            
            <mat-form-field class="filter-field">
              <mat-select formControlName="operationStatus" placeholder="Все">
                <mat-option [value]="null">Все</mat-option>
                <mat-option *ngFor="let status of operationStatuses" [value]="status">
                  {{ status }}
                </mat-option>
              </mat-select>
            </mat-form-field>
            
          </th>
          <td mat-cell *matCellDef="let row"> {{ row.operationStatus || '—' }} </td>
        </ng-container>

        <ng-container matColumnDef="objectCount">
          <th mat-header-cell *matHeaderCellDef>
            <div mat-sort-header="objectCount">objectCount</div>
            <mat-form-field class="filter-field">
              <input matInput formControlName="objectCount" (click)="$event.stopPropagation()">
            </mat-form-field>
          </th>
          <td mat-cell *matCellDef="let row"> {{row.objectCount}} </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        
        <tr class="mat-row" *matNoDataRow><td class="mat-cell" [attr.colspan]="displayedColumns.length">Нет данных.</td></tr>
      </table>
    </div>
    
    <mat-paginator [length]="resultsLength" [pageSize]="10" [pageSizeOptions]="[5, 10, 25, 100]"></mat-paginator>
  </div>
</div>